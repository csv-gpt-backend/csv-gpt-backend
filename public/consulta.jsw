// Se ejecuta del lado servidor de Wix
import { fetch } from 'wix-fetch';

// ⬅️⬅️ PON AQUÍ TU URL REAL DE VERCEL (NO el placeholder)
const BASE = "https://<tu-proyecto>.vercel.app";  // p.ej. https://csv-gpt-backend.vercel.app

export async function consultaAlumno(alumno, campos = "", fuente = "Ambos") {
  const qs = new URLSearchParams({ alumno, campos, fuente, formato: "tabla" });
  const r = await fetch(`${BASE}/api/ask?${qs.toString()}`, { method: "GET" });
  let json = null; try { json = await r.json(); } catch(e){}
  if (!r.ok || !json) throw new Error(`Backend /ask HTTP ${r.status}`);
  if (json.ok === false) throw new Error(json.error || "Backend ok:false");
  return json; // { ok, alumno, rows: [...] }
}

export async function statsCampo(campo, fuente = "Ambos") {
  const qs = new URLSearchParams({ campo, fuente });
  const r = await fetch(`${BASE}/api/stats?${qs.toString()}`, { method: "GET" });
  let json = null; try { json = await r.json(); } catch(e){}
  if (!r.ok || !json) throw new Error(`Backend /stats HTTP ${r.status}`);
  if (json.ok === false) throw new Error(json.error || "Backend ok:false");
  return json; // { ok, stats: { total:{...}, A:{...}, B:{...} } }
}
