// backend/consulta.jsw  (se ejecuta en el servidor de Wix)
import { fetch } from 'wix-fetch';

const BACKEND_URL = "https://csv-gpt-backend.vercel.app/api/ask"; // <-- tu dominio real

export async function consulta(alumno, campos = "", fuente = "Ambos") {
  const qs = new URLSearchParams({ alumno, campos, fuente, formato: "tabla" });
  const r = await fetch(`${BACKEND_URL}?${qs.toString()}`, { method: "GET" });
  // Si Vercel responde con error 4xx/5xx, igual intentamos leer el JSON
  let json = null;
  try { json = await r.json(); } catch (_e) {}
  if (!r.ok || !json) throw new Error(`Backend error HTTP ${r.status}`);
  if (json.ok === false)  throw new Error(json.error || "Backend respondiÃ³ ok:false");
  return json; // { ok:true, alumno, rows:[...] }
}
