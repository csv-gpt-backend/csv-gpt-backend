<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JJJJJJJJSV/PDF â†” GPT (MX/Ecuador)</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      color: #000;
    }

    /* Layout principal */
    .page {
      display: grid;
      grid-template-rows: auto 1fr 1fr;
      height: 100vh;
    }

    /* Encabezado fijo */
    header {
      position: sticky;
      top: 0;
      background: #fff;
      border-bottom: 1px solid #ddd;
      z-index: 10;
      padding: 8px;
    }

    /* Primera fila: imagen izquierda, video, imagen derecha */
    .media-row {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      align-items: center;
      gap: 8px;
      padding: 0 10px;
    }

    .media-row img {
      width: 100%;
      height: 140px;
      object-fit: contain;
    }

    /* Video centrado */
    .media-row video {
      width: 100%;
      height: 140px;
      object-fit: contain;
      background: #000;
      border-radius: 12px;
      border: none;
      aspect-ratio: 16/9;
    }

    /* Caja de texto */
    textarea {
      width: 100%;
      max-width: 800px;
      margin: 10px auto;
      display: block;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      resize: none;
    }

    /* Botones */
    .controls {
      text-align: center;
      margin: 10px 0;
    }

    button, select, a.btn {
      padding: 8px 14px;
      margin: 0 4px;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
      background: #fff;
      font-size: 14px;
    }

    button.primary { background: #2563eb; color: white; }
    button.yellow { background: #f59e0b; color: black; }

    /* Paneles de resultado */
    main {
      display: grid;
      grid-template-rows: 1fr 1fr;
      height: 100%;
    }

    .panel {
      padding: 12px;
      overflow-y: auto;
      border-top: 1px solid #ddd;
    }

    .panel h2 {
      font-size: 16px;
      margin: 0 0 8px;
      color: #444;
    }

    .result {
      font-size: 14px;
      line-height: 1.5;
    }

    /* Tablas */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="media-row">
        <img src="/left.png" alt="Left Image">
        <video id="heroVideo" 
          src="https://xsmr71ubix2w6tve.public.blob.vercel-storage.com/OLIVIA%20IN%20CASUAL.mp4"
          muted
          playsinline
          preload="metadata"
          poster="/right.png">
        </video>
        <img src="/right.png" alt="Right Image">
      </div>

      <textarea id="question" placeholder="Escribe tu pregunta o usa el micrÃ³fono..."></textarea>

      <div class="controls">
        <button id="sendBtn" class="primary">Enviar</button>
        <button id="micBtn">ðŸŽ¤</button>
        <select id="exportType">
          <option value="pdf">PDF</option>
          <option value="xlsx">XLSX</option>
          <option value="doc">DOC</option>
        </select>
        <button id="exportBtn">Exportar</button>
        <button id="muteBtn">ðŸ”‡ Silenciar voz</button>
        <button id="clearBtn">ðŸ§¹ Limpiar</button>
        <button id="newSessionBtn" class="yellow">ðŸ†• Nueva sesiÃ³n</button>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>Respuesta</h2>
        <div id="textOutput" class="result"></div>
      </section>

      <section class="panel">
        <h2>Tablas y Listas</h2>
        <div id="tableOutput" class="result"></div>
      </section>
    </main>
  </div>
// INICIO MARCELO 2
  <!-- Contenedor donde se mostrarÃ¡ la tabla -->
<div id="tables" style="overflow-x:auto; margin-top:10px;"></div>

<script>
  // FunciÃ³n para convertir Markdown en tabla HTML
  function renderMarkdownTable(markdown) {
    const lines = markdown.trim().split('\n');
    if (lines.length < 2) return '';

    // Encabezados
    const headers = lines[0].split('|').map(h => h.trim()).filter(h => h);

    // Filas de datos
    const rows = lines.slice(2).map(line =>
      line.split('|').map(c => c.trim()).filter(c => c)
    );

    let html = '<table border="1" cellpadding="5" cellspacing="0"><thead><tr>';
    headers.forEach(h => { html += `<th>${h}</th>`; });
    html += '</tr></thead><tbody>';

    rows.forEach(row => {
      html += '<tr>';
      row.forEach(cell => { html += `<td>${cell}</td>`; });
      html += '</tr>';
    });

    html += '</tbody></table>';
    return html;
  }

  // FunciÃ³n para actualizar la secciÃ³n de tablas
  function updateTable(markdown) {
    const container = document.getElementById('tables');
    container.innerHTML = renderMarkdownTable(markdown);
  }

  // Ejemplo: Cuando recibes la respuesta del backend
  async function enviarPregunta() {
    const question = document.getElementById('question').value;
    const res = await fetch('/api/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question })
    });
    const data = await res.json();

    // Texto general
    document.getElementById('answer').textContent = data.texto;

    // Tabla en Markdown â†’ HTML
    if (data.tablas_markdown) {
      updateTable(data.tablas_markdown);
    }
  }
</script>

  //FIN MARCELO 2
  <script>
    const video = document.getElementById('heroVideo');
    const sendBtn = document.getElementById('sendBtn');
    const textOutput = document.getElementById('textOutput');
    const tableOutput = document.getElementById('tableOutput');

    // Mostrar primer frame apenas cargue
    window.addEventListener('load', async () => {
      try { await video.play(); video.pause(); } catch(e) {}
    });

    async function askQuestion() {
      const question = document.getElementById('question').value.trim();
      if (!question) return alert("Escribe una pregunta.");

      textOutput.innerHTML = "Procesando...";

      try {
        const res = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await res.json();
        textOutput.innerHTML = data.texto || "Sin respuesta";
        tableOutput.innerHTML = data.tablas_markdown || "";
        
        // reproducir video mientras habla
        video.play();
        setTimeout(() => video.pause(), 5000);
      } catch (err) {
        textOutput.innerHTML = "OcurriÃ³ un error. Por favor, intenta de nuevo.";
      }
    }

    sendBtn.addEventListener('click', askQuestion);
  </script>
</body>
</html>
